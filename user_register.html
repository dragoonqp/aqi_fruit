<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title></title>
		<link rel="stylesheet" href="css/common.css" type='text/css'>
		<link rel="stylesheet"  type="text/css" href="../css/regpage.css" >	
	</head>
	<body onload='getlist()'>
		<header>
			<!-- 头部登录区 -->
			<div id='title'>
				<div class='content'>
					<span>您好，欢迎来到阿七果园子！</span>
					<ul class='right mycenter'>
						<li><a href='user_login.html' title='登录账户'>[登录]</a>&nbsp;</li>
						<li><a href='user_register.html' title='注册新用户'>[注册有惊喜]</a></li>
						<li><a href='' title='个人中心'>我的果园</a></li>
						<li><a href='' title='移动端'>手机果园</a></li>
						<li>400-720-0770</li>
					</ul>
				</div>
			</div>
			<div id='searchbardiv'>
				<div class='content'>
					<!-- logo图片 -->
					<h3 class='logo'><a href="index.html" title='阿七果园'></a></h3>
					<h4 class='logo'><a href="index.html" title='阿七果园'></a></h4>
					<!-- 配送 -->
					<div id="delivery">
						
					</div>
					<!-- 搜索框及搜索热点 -->
					<div id="searchbar">
						<span>搜索热点:</span>
						<ul id='hot'>
							<li></li>
							<li></li>
							<li></li>
							<li></li>
							<li></li>
							<li></li>
						</ul>
						<div id="searchBtn">搜索</div>
						<input type="text" id='search'>
					</div>
					<div class="clearfix"></div>
				</div>
			</div>
		</header>
		
		<nav>
			<div class='content'>
				<ul class="nav">
					<li id='allproducts' ><a href="">全部商品</a>
						<ul class='subnav'>
							<li><a href="">所有鲜果</a></li>
							<li><a href="">进口鲜果</a></li>
							<li><a href="">国产鲜果</a></li>
							<li><a href="">休闲食品</a></li>
							<li><a href="">礼盒花篮</a></li>
							<li><a href="">消费卡券</a></li>
							<li><a href="">宝贝水果</a></li>
							<li><a href="">孕妇水果</a></li>
							<li><a href="">老人水果</a></li>
							<li><a href="">其他</a></li>
						</ul>
					</li>
					<li><a href="">首页</a></li>
					<li><a href="">进口鲜果</a></li>
					<li><a href="">国产鲜果</a></li>
					<li><a href="">在线充值</a></li>
					<li><a href="">团购配送</a></li>
					<li><a href="">其他</a></li>
				</ul>
				<div id='shopcar'><a href=""><i></i> 购物车</a></div>
			</div>
		</nav>
		<section>
			<div class="content">
				<div id='head'>
					<div>用户注册</div>
					<a class='login' href="user_login.html" >登陆</a>
				</div>
				<div id='regdiv'>
					<div><div class='reqtitle'>用户账号:</div>
						<input type="text" class='inputArea' id='uname' onfocus='uname_focus()' onblur='uname_blur()' maxlength='9'>
						<span id='input_uname'></span>
					</div>
					<div><div class='reqtitle'>用户密码:</div>
						<input type="password" class='inputArea' id='upwd' onfocus='upwd_focus()' onblur='upwd_blur()' maxlength='12'>
						<span id='input_upwd'></span>
					</div>
					<div><div class='reqtitle'>密码验证:</div>
						<input type="password" class='inputArea' id='rupwd' onblur='rupwd_blur()'>
						<span id='input_rupwd'></span>
					</div>
					<div><div class='reqtitle'>电子邮箱:</div>
						<input type="email" class='inputArea' id='email'>
					</div>
					<div><div class='reqtitle'>联系电话:</div>
						<input type="text" class='inputArea' id='phone'>
					</div>
					<div><div class='reqtitle'>真实姓名:</div>
						<input type="text" class='inputArea' id='user_name'>	
					</div>
					<div><div class='reqtitle' >性别:</div>
						<input type="radio" class='genderradio' name='gender' id='m' value=1><label for="m">男</label>
						<input type="radio" class='genderradio' name='gender' id='fm' value=0><label for="fm">女</label>
					</div>
					<div><div class='reqtitle'>安全问题:</div>
						<select name="safeQue" id="safeQue" class='inputArea' >
							<option value="safeQue1">你的第一份工作是什么？</option>
							<option value="safeQue2">你最喜欢的运动是什么？</option>
							<option value="safeQue3">你的高中老师叫什么？</option>
							<option value="safeQue4">你爸爸的名字叫什么？</option>
						</select>
					</div>
					<div><div class='reqtitle'>安全问题答案:</div>
						<input type="text" class='inputArea' id='safeAns'>
					</div>
					<div>
						 <div class='reqtitle'></div>
						 <div onclick='register()' class="registerbtn" style=''>提交注册信息</div><span id='regText'></span>
					</div>
				</div>
			</div>	
		</section>
		
		
		<footer>
			<div class="content">
				<div class="ltext">
					<div>
						<h3>新手指南</h3>
						<ul>
							<li>购物流程</li>
							<li>用户注册</li>
							<li>会员积分</li>
							<li>联系客服</li>
						</ul>
					</div>
					<div>
						<h3>付款方式</h3>
						<ul>
							<li>货到付款</li>
							<li>在线支付</li>
							<li>在线充值</li>
						</ul>
					</div>
					<div>
						<h3>配送服务</h3>
						<ul>
							<li>配送运费</li>
							<li>配送范围</li>
							<li>配送时间</li>
							<li>配送须知</li>
						</ul>
					</div>
					<div>
						<h3>售后服务</h3>
						<ul>
							<li>关于商品的退换</li>
							<li>关于退换的处理</li>
							<li>关于退款</li>
							<li>投诉建议</li>
						</ul>
					</div>
					<div>
						<h3>关于我们</h3>
						<ul>
							<li>关于阿七果园子</li>
							<li>联系我们</li>
							<li>业务合作</li>
							<li>招贤纳士</li>
						</ul>
					</div>
				</div>
				<div class="rimg">
					<img src="../image/1_36.png" alt="">
					<img src="../image/footercontact_38.png" alt="">
					<p>客服电话:0571-83539906</p>
					<p>地址:浙江省杭州市萧山区</p>
				</div>
			</div>
		</footer>
		<script>
			function uname_focus(){
				input_uname.innerHTML='用户名长度在6~9位之间';
			}

			var result1={};
			function uname_blur(){
				if(!uname.value){
					input_uname.innerHTML='用户名不能为空'
					return;
				}else if(uname.value.length>=3 && uname.value.length<=9){
					var xhr = new XMLHttpRequest();
					xhr.onreadystatechange = function (){
						if(xhr.readyState==4 && xhr.status==200){
							result1 = JSON.parse(xhr.responseText);
							if(result1.code==0){
								input_uname.innerHTML='用户名已被占用'
							}else{
								input_uname.innerHTML='用户名可以使用'
							}
						}
					}
					//`/ajax/registerCheck?uname=${uname.value}`
					xhr.open('get','/user/registerCheck?uname='+uname.value,true);
					xhr.send(null);
				}else{
					input_uname.innerHTML='用户名不能少于3位';
				}
			}


			function upwd_focus(){
				input_upwd.innerHTML='密码长度在6~12位之间';
			}
			var isRegister=false;
			function rupwd_blur(){
				if(!rupwd.value){
					input_rupwd.innerHTML='确认密码不能为空'
					isRegister=false;
				}else if(upwd.value==rupwd.value){
					input_rupwd.innerHTML='两次密码一致'
					isRegister=true;
				}else{
					input_rupwd.innerHTML='两次输入的密码不一致'
					isRegister=false;
				}
			}
			function upwd_blur(){
				if(!upwd.value){
					input_upwd.innerHTML='密码不能为空'
					return;
				}else if(upwd.value.length>=6 && uname.value.length<=12){
					input_upwd.innerHTML='密码格式正确'
				}else{
					input_upwd.innerHTML='密码不能少于6位'
				}
			}
			
			function register(){
				if(result1.code==0 || result1.code==undefined && isRegister==false){
					regText.innerHTML='请填写信息';
					return;
				}else{
					var input_gender;
					if(m.checked){
						input_gender=1;
					}else if(fm.checked){
						input_gender=0;
					}else{
						input_gender=null;
					}
					var xhr = new XMLHttpRequest();
					xhr.onreadystatechange=function (){
						if(xhr.readyState==4 && xhr.status==200){
							//console.log(xhr.responseText)
							var result=JSON.parse(xhr.responseText);
							for(var i=101;i<105;i++){
								if(result.code==i){
									alert(result.msg)
								}
							}
							if(result.code==200){
								alert('注册成功');
								//window.location.href='http://127.0.0.1:3000/index.html'
							}else if(result.code==400){
								alert('注册失败');
							}
						}
					}
					xhr.open('post','/user/register',true);
					xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
					var formdata='uname='+uname.value+"&upwd="+upwd.value+'&email='+email.value+'&phone='+phone.value+'&user_name='+user_name.value+'&gender='+input_gender+'&safeQue='+safeQue.value+'&safeAns='+safeAns.value;
					xhr.send(formdata);
				}
			}

		</script>
	</body>
</html>